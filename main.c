#include <stdio.h>
#include <string.h>
//#include <time.h>
#include "kalman.h"

unsigned short sampleSize = 508;
int sample[] = {78,  78,  82,  82,  82,  86,  83,  78,  79,  79,  79,  79,  79,  79,  81,  84,  83,  78,  78,  82,  84,  85,  84,  82,  82,  82,  80,  79,  79,  83,  83,  87,  86,  86,  86,  86,  86,  86,  82,  82,  80,  80,  80,  81,  81,  76,  76,  76,  76,  81,  82,  83,  77,  77,  76,  80,  82,  85,  87,  87,  89,  84,  85,  85,  86,  86,  86,  84,  84,  84,  84,  84,  84,  83,  82,  84,  84,  85,  83,  84,  85,  86,  87,  88,  88,  88,  88,  88,  88,  86,  86,  84,  84,  81,  80,  77,  78,  78,  77,  77,  77,  77,  77,  77,  78,  78,  78,  80,  76,  76,  76,  76,  77,  77,  77,  82,  82,  82,  83,  82,  77,  81,  81,  81,  82,  82,  77,  78,  81,  81,  78,  83,  82,  81,  80,  80,  81,  81,  80,  77,  77,  77,  77,  80,  81,  77,  77,  78,  78,  81,  83,  83,  78,  83,  82,  77,  77,  80,  82,  87,  82,  78,  80,  81,  81,  81,  78,  78,  78,  78,  78,  78,  81,  78,  77,  77,  77,  77,  77,  77,  77,  77,  77,  77,  77,  77,  77,  79,  77,  81,  85,  84,  84,  83,  79,  83,  77,  78,  77,  77,  82,  81,  81,  79,  77,  77,  77,  77,  77,  77,  78,  82,  81,  82,  79,  78,  83,  82,  82,  80,  80,  81,  80,  77,  77,  77,  82,  83,  82,  77,  82,  83,  88,  88,  88,  88,  88,  88,  88,  88,  84,  85,  85,  85,  85,  85,  85,  85,  87,  85,  88,  88,  88,  88,  90,  84,  84,  84,  84,  88,  84,  83,  83,  83,  78,  78,  78,  78,  78,  83,  84,  84,  78,  78,  78,  78,  78,  79,  79,  82,  85,  84,  82,  77,  81,  82,  79,  81,  78,  78,  78,  78,  78,  80,  78,  79,  80,  80,  81,  79,  80,  79,  80,  82,  77,  80,  84,  86,  86,  81,  85,  83,  84,  84,  84,  84,  82,  86,  86,  86,  86,  86,  82,  79,  79,  80,  80,  80,  80,  82,  80,  81,  82,  80,  80,  81,  78,  78,  78,  78,  78,  78,  78,  78,  79,  79,  79,  79,  78,  78,  78,  78,  77,  78,  82,  79,  79,  82,  82,  86,  84,  85,  85,  81,  79,  76,  76,  77,  79,  76,  77,  76,  76,  81,  77,  82,  82,  80,  79,  80,  78,  78,  79,  82,  83,  83,  77,  77,  77,  77,  81,  84,  85,  83,  77,  78,  78,  80,  80,  79,  82,  80,  80,  77,  76,  76,  80,  80,  77,  77,  77,  78,  82,  83,  77,  79,  79,  79,  82,  81,  82,  78,  80,  77,  77,  81,  82,  80,  80,  81,  77,  81,  79,  77,  80,  79,  78,  76,  77,  77,  80,  76,  76,  76,  76,  76,  76,  76,  77,  76,  76,  76,  76,  77,  77,  77,  77,  79,  81,  84,  88,  91,  91,  91,  91,  91,  91,  86,  82,  79,  76,  78,  78,  78,  76,  78,  78,  83,  79,  84,  78,  76,  76,  77,  79,  79,  83,  85,  88,  88,  85,  80,  84,  80,  80,  80,  80,  80,  82,  83,  83,  80,  80,  80,  81,  84,  84,  83};
int threshold = 6;
unsigned long sum =0;





int main ()
{
     printf("\nRaw Data  : \n");
     for (int i=0; i<sampleSize; i++){
        printf("%d, ", sample[i] );
        sum+=sample[i];
     }
     for (int i=0; i<sampleSize; i++){
        if(sample[i+1] >= sample[i]+threshold || sample[i+1] < sample[i]-threshold){
            sample[i+1] = sample[i];
        }
    }
    printf("\nAverage %d \n",sum/sampleSize);
    printf("Filtered Data  : \n");
    sum = 0;
    KalmanFilter kalmanFilter;
    kalmanFilter.setProcessNoise(0.01);
    kalmanFilter.setMeasurementNoise(15.4);
    for (int i=0; i<sampleSize; i++){
        sample[i] = filter(sample[i]);
        printf("%d, ", sample[i] );
        sum+=sample[i];
    }
    printf("\nAverage %d \n",sum/sampleSize);

    puts("*****************************************************");




    return(0);
}
